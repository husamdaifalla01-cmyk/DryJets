# Getting Started with DryJets Development

This guide will help you set up and start developing the DryJets platform with Supabase.

## Quick Start (5 minutes)

### 1. Install Dependencies

```bash
npm install
```

### 2. Setup Supabase Project

1. Go to [supabase.com](https://supabase.com) and create a free account
2. Create a new project (takes ~2 minutes to provision)
3. Copy your project credentials from Settings > API:
   - Project URL
   - Anon/Public Key
   - Service Role Key (keep secret!)
   - Database Connection String

### 3. Setup Environment

```bash
cp .env.example .env
```

Edit `.env` and add your Supabase credentials:
```env
# Supabase Configuration
SUPABASE_URL="https://your-project.supabase.co"
SUPABASE_ANON_KEY="your-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

# Database (from Supabase Settings > Database)
DATABASE_URL="postgresql://postgres:[YOUR-PASSWORD]@db.your-project.supabase.co:5432/postgres"

# Other Services
STRIPE_SECRET_KEY="your-stripe-key"
GOOGLE_MAPS_API_KEY="your-google-maps-key"
```

### 4. Initialize Database

```bash
cd packages/database
npm run db:migrate
npm run db:generate
cd ../..
```

This will:
- Run Prisma migrations on your Supabase database
- Generate the Prisma client
- Set up all tables with proper relationships

### 5. Start Development Servers

```bash
# Terminal 1: Start Merchant Portal
npm run dev --workspace=@dryjets/web-merchant

# Terminal 2: Start Customer Mobile App
npm run dev --workspace=@dryjets/mobile-customer

# Terminal 3: Start Driver Mobile App
npm run dev --workspace=@dryjets/mobile-driver
```

**Note**: Backend APIs are auto-generated by Supabase! No need to run a separate API server.

## Detailed Setup

### Prerequisites

Make sure you have installed:

- **Node.js 20+**: `node --version`
- **npm 10+**: `npm --version`
- **Git**: `git --version`
- **Supabase Account**: [Sign up here](https://supabase.com)

### Project Structure Overview

```
dryjets-platform/
â”œâ”€â”€ apps/                    # Applications
â”‚   â”œâ”€â”€ web-merchant/        # Merchant Portal (Next.js) - Port 3002
â”‚   â”œâ”€â”€ mobile-customer/     # Customer App (React Native)
â”‚   â””â”€â”€ mobile-driver/       # Driver App (React Native)
â”œâ”€â”€ packages/                # Shared code
â”‚   â”œâ”€â”€ database/            # Prisma schema & migrations
â”‚   â”œâ”€â”€ types/               # TypeScript types
â”‚   â”œâ”€â”€ ui/                  # Shared UI components
â”‚   â””â”€â”€ hooks/               # Shared React hooks
â””â”€â”€ infrastructure/          # Optional Docker configs for local services
```

### Database Setup

The database schema includes:
- Users (multi-role: customer, driver, merchant, admin)
- Orders (complete order lifecycle)
- Payments (Stripe integration ready)
- Merchants (business management)
- Drivers (gig economy model)
- Equipment tracking
- Maintenance logs
- And much more!

View the full schema: [packages/database/prisma/schema.prisma](packages/database/prisma/schema.prisma)

**Important**: All tables are hosted on Supabase PostgreSQL with Row-Level Security (RLS) policies.

### Supabase Features Available

Once set up, you have access to:

1. **Auto-generated APIs**
   - REST API (PostgREST)
   - GraphQL API
   - View docs in Supabase Dashboard > API Docs

2. **Authentication**
   - Email/Password
   - Magic Links
   - OAuth (Google, GitHub, etc.)
   - Manage in Supabase Dashboard > Authentication

3. **Real-time Subscriptions**
   - Live updates via WebSocket
   - Subscribe to any table changes
   - Perfect for order tracking, driver location, etc.

4. **Storage**
   - File uploads (images, documents)
   - Automatic image resizing
   - CDN-backed delivery

5. **Edge Functions**
   - Deploy serverless functions (Deno)
   - Custom business logic
   - Webhooks and integrations

### Accessing Your Project

- **Supabase Dashboard**: https://app.supabase.com
  - Database browser
  - Auth users management
  - Storage browser
  - Real-time inspector
  - API documentation

- **Merchant Portal**: http://localhost:3002
- **Customer App**: Expo Go (scan QR code from terminal)
- **Driver App**: Expo Go (scan QR code from terminal)

### Development Workflow

1. **Database Changes**
   ```bash
   cd packages/database
   # Edit schema.prisma
   npm run db:migrate -- --name your_migration_name
   npm run db:generate
   ```

2. **Adding Authentication**
   - Use Supabase Auth in your components
   - Example: `const { user, session } = useSupabaseAuth()`

3. **Real-time Updates**
   ```typescript
   // Subscribe to order updates
   const subscription = supabase
     .channel('orders')
     .on('postgres_changes', 
       { event: '*', schema: 'public', table: 'orders' },
       (payload) => console.log('Change received!', payload)
     )
     .subscribe()
   ```

4. **File Uploads**
   ```typescript
   const { data, error } = await supabase.storage
     .from('order-images')
     .upload(`public/${file.name}`, file)
   ```

### Useful Commands

```bash
# Install dependencies
npm install

# Start all apps
npm run dev

# Start specific app
npm run dev --workspace=@dryjets/web-merchant

# Build all apps
npm run build

# Run tests
npm run test

# Format code
npm run format

# Lint code
npm run lint
```

### Environment Variables

Required environment variables (`.env`):

```env
# Supabase
SUPABASE_URL=your-project-url
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
DATABASE_URL=your-database-url

# Payments
STRIPE_SECRET_KEY=your-stripe-key
STRIPE_PUBLISHABLE_KEY=your-stripe-publishable-key

# Maps
GOOGLE_MAPS_API_KEY=your-google-maps-key

# Communications
TWILIO_ACCOUNT_SID=your-twilio-sid
TWILIO_AUTH_TOKEN=your-twilio-token
SENDGRID_API_KEY=your-sendgrid-key
```

### Troubleshooting

**Issue**: Database connection fails
- **Solution**: Check your DATABASE_URL in `.env` matches your Supabase project

**Issue**: API requests return 401
- **Solution**: Verify your SUPABASE_ANON_KEY is correct

**Issue**: Real-time subscriptions not working
- **Solution**: Enable Realtime for your tables in Supabase Dashboard > Database > Replication

**Issue**: File uploads fail
- **Solution**: Create storage buckets in Supabase Dashboard > Storage

### Next Steps

1. âœ… Complete the setup above
2. ğŸ“š Read the [Main README](README.md) for architecture details
3. ğŸ—„ï¸ Explore your database schema in Supabase Dashboard
4. ğŸ” Set up authentication flows
5. ğŸ“± Test the mobile apps with Expo Go
6. ğŸ¨ Customize the merchant portal UI
7. ğŸš€ Deploy to production when ready

### Getting Help

- **Supabase Docs**: https://supabase.com/docs
- **Prisma Docs**: https://www.prisma.io/docs
- **Next.js Docs**: https://nextjs.org/docs
- **React Native Docs**: https://reactnative.dev/docs

---

**DryJets** - Cloud-first laundry marketplace platform powered by Supabase
